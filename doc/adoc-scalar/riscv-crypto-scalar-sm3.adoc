[[crypto_scalar_sm3]]
=== Scalar SM3 Instructions

Synopsis::
Lightweight instructions for accelerating the SM3 Cryptographic Hash
Function.

Mnemonic::

----
sm3p1 rd, rs1
sm3p0 rd, rs1
----

Encoding::
[wavedrom, , svg]
----
{reg:[
    {bits: 32, name:todo,attr:["todo"]}
]}
----

Description::
These instructions are designed to accelerate the SM3 secure
hash function\cite{ietf:sm3}.
They are based on work done in \cite{MJS:LWSHA:20}, and follow
the same pattern as the scalar SHA2 instructions
(Section <<crypto_scalar_sha256>>).
The instructions implement versions of the $P_0$ and $P_1$
permutations, per the SM3 specification \cite{ietf:sm3}.

Operation::
[source,sail]
--
function crypto_sm3(op, rd, rs1) = {
  let r1     : bits(32) = X(rs1)[31..0];
  let result : bits(32) = match op {
    P0  => r1 ^ rol32(r1,  9) ^ rol32(r1, 17),
    P1  => r1 ^ rol32(r1, 15) ^ rol32(r1, 23)
  };
  X(rd) = EXTZ(result);
  RETIRE_SUCCESS
}
--
